<aside id="mailbox-sidebar"
       (clickOutside)="toggleMenu()"
       class="mailbox-sidebar is-sidebar-expandedx" role="complementary" [ngClass]="{'is-sidebar-expanded': isSidebarOpened}">
    <div class="mailbox-sidebar-inner">

        <div class="mailbox-brand">
            <button class="navbar-toggler hidden-md-up" role="button" (click)="toggleMenu()">
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggle-text">Menu</span>
            </button>
            <figure class="navbar-brand-holder hidden-sm-down">
                <a class="navbar-brand ff-roboto text-uppercase" routerLink="/mail">
                    <img alt="Ctemplar Logo" class="navbar-brand-logo" src="assets/images/logo.svg"/>
                    <strong>ctemplar</strong>
                </a>
            </figure>
            <div class="prime-account-content" *ngIf="userState.isPrime">
                <i class="icon icon-secure-shield"></i>
                <span class="prime-account-text">Prime</span>
            </div>
        </div>

        <div class="mail-compose-section hidden-xs-down">
            <button class="btn btn-lg btn-primary mailbox-btn mailbox-compose-btn btn-xs-squared has-icon" role="button"
                    (click)="openComposeMailDialog();">
                <i class="icon icon-plus text-white hidden-md-up"></i>
                <span class="mailbox-btn-text hidden-sm-down" translate="common.compose">Compose</span>
            </button>
        </div>

        <nav class="mailbox-sidebar-navbar">
            <ul class="mailbox-sidebar-nav">
                <li class="mailbox-sidebar-nav-item" routerLinkActive="active">
                    <a routerLink="/mail/inbox" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-inbox"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.inbox">Inbox</span>
                        <span class="badge badge-square d-lg-block d-md-block d-sm-none" *ngIf="inboxUnreadCount>0">{{inboxUnreadCount}}</span>
                        <span class="badge badge-sm badge-square d-none d-sm-block">{{inboxUnreadCount}}</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/draft" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-draft"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.draft">Draft</span>
                        <span class="badge badge-square hidden-sm-down" *ngIf="draftCount>0">{{draftCount}}</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/sent" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-paper-plane"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.sent">Sent</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/outbox" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-draft"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.outbox">Outbox</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/starred" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-star"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.starred">Starred</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/archive" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-archive"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.archive">Archive</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/spam" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-warning"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.spam">Spam</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active">
                    <a routerLink="/mail/trash" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                        <i class="icon icon-garbage"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.trash">Trash</span>
                    </a>
                </li>

                <!-- Custom Folder -->
                <li class="divider-item"></li>
                <li class="mailbox-sidebar-nav-item">
                    <a class="mailbox-sidebar-nav-link" (click)="open()">
                        <i class="icon icon-folder"></i>
                        <span class="mailbox-sidebar-nav-label" translate="mail_sidebar.add_folder">Add folder</span>
                    </a>
                </li>
                <li class="mailbox-sidebar-nav-item"  routerLinkActive="active" *ngFor="let folder of customFolders|slice:0:LIMIT; let i=index;">
                    <div>
                        <a routerLink="/mail/{{folder.name}}" class="mailbox-sidebar-nav-link" (click)="toggleMenu()">
                            <i class="folder-color-box icon" [style.background]="folder.color"></i>
                            <span class="mailbox-sidebar-nav-label text-capitalize">
                                {{folder.name}}
                            </span>
                        </a>
                        <button class="btn btn-link btn-sm float-right hover-icon px-1 py-0 text-white" (click)="$event.preventDefault();showConfirmationModal(folder)">
                            <i class="icon icon-cross icon-sm"></i>
                        </button>
                    </div>
                </li>
                <li class="mailbox-sidebar-nav-item" *ngIf="customFolders?.length > LIMIT">
                    <a (click)="toggleDisplayLimit(customFolders.length)"
                       class="mailbox-sidebar-nav-link">
                        <span class="mailbox-sidebar-nav-label text-capitalize">
                            {{LIMIT === customFolders.length? 'Less' : 'More'}}
                        </span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="mailbox-sidebar-footer text-center mt-4 py-2">
                <div class="mailbox-sidebar-footer-text mb-0 mb-md-1 visible-in-sm" translate="mail_sidebar.used">Used
                    <div class="text-white mt-1">{{(userState.settings?.used_storage * 1024) | filesize}}</div>
                </div>
            <div class="mailbox-sidebar-footer-text hidden-in-sm">
                <span translate="common.used_storage">Used storage</span>: {{(userState.settings?.used_storage * 1024) | filesize}} of {{(userState.settings.allocated_storage  * 1024) | filesize}}</div>
            <a routerLink="/mail/settings" class="btn-link text-white hidden-in-sm" *ngIf="!userState.isPrime">
                <small>
                    <u translate="common.upgrade_account">Upgrade account</u>
                </small>
            </a>
        </div>

    </div>
</aside>

<!-- Compose button to be used in small screens -->
<div class="btn-xs-holder is-sticky hidden-sm-up">
    <button class="btn btn-primary mailbox-btn mailbox-compose-btn btn-xs-rounded has-icon" role="button"
            placement="top" [ngbTooltip]="'common.compose' | translate" (click)="openComposeMailDialog();"><i
            class="icon icon-plus text-white"></i></button>
</div>

<!-- Mail compose dialog container -->
<div class="compose-mail-container">
    <ng-template #composeMailContainer></ng-template>
</div>


<!-- TODO: refactor to stand alone component: LATER -->
<!-- Confirm discard email modal -->
<ng-template #confirmationModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h3 class="modal-title w-100 text-dark"><strong>Confirm Delete</strong></h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="d()">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body bg-faded">
        <div class="mail-actions-form-holder modal-mail-actions-form-holder">
        <div class="form-group">
            Are you sure, you want to delete folder <b>"{{selectedFolder?.name}}"</b>?
        </div>
        <div class="form-group text-right mb-0">
            <button (click)="d()" class="btn btn-secondary btn-sm" role="button">Cancel</button>
            <button (click)="deleteFolder()" class="btn btn-danger btn-sm" role="button" [disabled]="!mailState.loaded">Delete</button>
        </div>
        </div>
    </div>
</ng-template><!-- /.Confirm discard email modal ends -->