# CTemplar

[![Build Status](https://travis-ci.org/CTemplar/webclient.svg?branch=master)](https://travis-ci.org/CTemplar/webclient)

Official Angular cross-platform client for the CTemplar secure email service.

## Prerequisites

This project was generated with [Angular CLI](https://github.com/angular/angular-cli) version 1.7.3 and upgraded to 9.0.6.

- Node (`v12.4.0` or higher)
- Angular CLI
  ```
  npm install -g @angular/cli@9.0.6
  ```

## Installation

```
npm install
```

## Usage

### Development server

Run `ng serve` for a dev server. Navigate to `http://localhost:4200/`. The app will automatically reload if you change any of the source files.

### Build

Run `ng build` to build the project. The build artifacts will be stored in the `dist/` directory. Use the `-prod` flag for a production build.

### Build Electron client

Run the following command in order to build electron client for all platform

```bash
npm run pack-all
```

Build for a specific platform

```bash
 npm run pack -- --platform=<platform> --arch=<arch>
```

For example:

```bash
 npm run pack -- --platform=win32 --arch=x64

OR

 npm run pack -- --platform=darwin --arch=x64

OR

 npm run pack -- --platform=linux --arch=x64
```

#### Supported platforms

You can generate executables/bundles for the following **target** platforms:

- Windows (also known as `win32`, for x86, x86_64, and arm64 architectures)
- macOS (also known as `darwin`)
- Linux (for x86, x86_64, armv7l, arm64, and mips64el architectures)

For more information, visit electron-packager [documentation](https://github.com/electron/electron-packager#supported-platforms).

### Running unit tests

Run `ng test` to execute the unit tests via [Karma](https://karma-runner.github.io).

### Running end-to-end tests

Run `ng e2e` to execute the end-to-end tests via [Protractor](http://www.protractortest.org/).

## Security

CTemplar uses [bcrypt.js](https://github.com/dcodeIO/bcrypt.js) and [OpenPGP.js](https://github.com/openpgpjs/openpgpjs) for hashing and encryption.

### Hash Password

CTemplar hashes every password before sending it to server for authentication or sign-up purposes.
A unique salt is created from user's Username which is then used to hash the password using `bcrypt.hashSync(password, salt)` method.

### Encryption

CTemplar encrypts and decrypts contents of every email using user's public/private key pair which is generated during sign up process.

- Public/Private Key pair is generated by `openpgp.generateKey` method using user's plain password as `passphrase`.
  ```
  const options = {
    userIds: [{ name: username, email: 'username@ctemplar.com' }],
    numBits: 4096,
    passphrase: password
  };
  openpgp.generateKey(options);
  ```
- Mail contents are encrypted by `openpgp.encrypt` method using receiver's Public Key.
  ```
  const options = {
      data: content,
      publicKeys: openpgp.key.readArmored(publicKey).keys
  };
  openpgp.encrypt(options);
  ```
- Mail contents are decrypted by `openpgp.decrypt` method using user's Private Key.

  ```
  let decryptedPrivateKey = openpgp.key.readArmored(privateKey).keys[0];
  decryptedPrivateKey.decrypt(passphrase);

  const options = {
      message: openpgp.message.readArmored(encryptedContent),
      privateKeys: [decryptedPrivateKey]
  };
  openpgp.decrypt(options);
  ```

## Transparent build code

We host our build code publicly on github and we also provide the details on how to match checksum of code on github and the one we serve
on our website. Find the details of build and how to calculate checksum here : [https://github.com/CTemplar/webclient/blob/gh-pages/README.md](https://github.com/CTemplar/webclient/blob/gh-pages/README.md)

## Contribution

This project is still in early phase so bug reports via Issues and Pull Requests are welcome.

## Further help

To get more help on the Angular CLI use `ng help` or go check out the [Angular CLI README](https://github.com/angular/angular-cli/blob/master/README.md).

## License

Apache License 2.0
